"0","#| label: preprocess-data"
"0","#| eval: false"
"0",""
"0","cli::cli_h2(""Data Preprocessing"")"
"0",""
"0","# Load data if not in environment"
"0","if(!exists(""bioactivity_raw"")) {"
"0","  bioactivity_raw <- read_csv(""data/bioactivity_raw.csv"")"
"0","}"
"0","str(bioactivity_raw$standard_value)"
"1"," chr [1:261] "
"1",""
"1","""7200.0"" ""9400.0"" ""13500.0"" ""13110.0"" ""2000.0"" ""980.0"" ""4820.0"" ""950.0"" ""11200.0"" ""23500.0"" ""12570.0"" ""17500.0"""
"1",""
"1"," ..."
"1",""
"1","
"
"0","bioactivity_raw <- bioactivity_raw %>%"
"0","  mutate(standard_value = suppressWarnings(as.numeric(standard_value)))"
"0",""
"0","# Preprocess bioactivity data"
"0","bioactivity_clean <- bioactivity_raw %>%"
"0","  filter("
"0","    standard_type == ""IC50"","
"0","    !is.na(standard_value),"
"0","    !is.na(canonical_smiles),"
"0","    standard_value > 0,"
"0","    standard_units == ""nM"""
"0","  ) %>%"
"0","  mutate("
"0","    # Convert IC50 (nM) to pIC50"
"0","    pIC50 = -log10(standard_value * 1e-9),"
"0","    "
"0","    # Classify activity"
"0","    bioactivity_class = case_when("
"0","      pIC50 >= 7 ~ ""Highly Active"",  # IC50 <= 100 nM"
"0","      pIC50 >= 6 ~ ""Active"",         # IC50 <= 1 µM"
"0","      pIC50 >= 5 ~ ""Moderately Active"", # IC50 <= 10 µM"
"0","      TRUE ~ ""Inactive"""
"0","    )"
"0","  ) %>%"
"0","  # Remove duplicates, keep median pIC50"
"0","  group_by(molecule_chembl_id, canonical_smiles) %>%"
"0","  summarise("
"0","    pIC50 = median(pIC50, na.rm = TRUE),"
"0","    standard_value_median = median(standard_value, na.rm = TRUE),"
"0","    bioactivity_class = first(bioactivity_class),"
"0","    n_measurements = n(),"
"0","    .groups = ""drop"""
"0","  ) %>%"
"0","  filter(pIC50 >= 4) %>%  # Focus on compounds with some activity"
"0","  arrange(desc(pIC50))"
"0",""
"0","cli::cli_alert_success(glue(""Cleaned data: {nrow(bioactivity_clean)} unique compounds""))"
"0",""
"0","# Save cleaned data"
"0","write_csv(bioactivity_clean, ""data/bioactivity_clean.csv"")"
"0",""
"0","# Summary statistics"
"0","bioactivity_clean %>%"
"0","  group_by(bioactivity_class) %>%"
"0","  summarise("
"0","    Count = n(),"
"0","    Mean_pIC50 = mean(pIC50),"
"0","    Median_pIC50 = median(pIC50),"
"0","    SD_pIC50 = sd(pIC50)"
"0","  ) %>%"
"0","  knitr::kable("
"0","    caption = ""Bioactivity Distribution"","
"0","    digits = 2"
"0","  )"
